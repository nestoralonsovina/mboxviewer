<div class="flex h-screen max-md:flex-col">
  <!-- Sidebar -->
  <app-sidebar
    [stats]="mbox.stats()"
    [labels]="mbox.labels()"
    [selectedLabel]="mbox.selectedLabel()"
    [searchQuery]="mbox.searchQuery()"
    [currentPath]="mbox.currentPath()"
    (openFile)="onOpenFile()"
    (closeFile)="onCloseFile()"
    (labelClick)="onLabelClick($event)" />

  <!-- Main Content -->
  <main class="flex-1 flex flex-col min-w-0">
    <!-- Toolbar -->
    <app-search-toolbar
      [isSearching]="mbox.isSearching()"
      [searchResultsCount]="mbox.searchResultsCount()"
      [emailCount]="mbox.emails().length"
      (searchChange)="onSearchInput($event)"
      (clearSearch)="onClearSearch()" />

    <!-- Content Area -->
    <div class="flex-1 flex overflow-hidden">
      <!-- Email List -->
      <app-email-list
        [class]="mbox.selectedEmail()
          ? 'w-2/5 min-w-[300px] max-md:hidden border-r border-slate-200 dark:border-slate-700'
          : 'flex-1'"
        [emails]="mbox.emails()"
        [selectedEmail]="mbox.selectedEmail()"
        [isLoading]="mbox.loadingFile() || mbox.loadingEmails()"
        [isLoadingMore]="mbox.loadingMore()"
        [hasMore]="mbox.hasMore()"
        [searchQuery]="mbox.searchQuery()"
        [selectedLabel]="mbox.selectedLabel()"
        (emailClick)="onEmailClick($event)"
        (loadMore)="onLoadMore()" />

      <!-- Email Detail -->
      @let email = mbox.selectedEmail();
      @if (email) {
        <app-email-detail
          [email]="email"
          [emailBody]="mbox.selectedEmailBody()"
          [isLoading]="mbox.loadingEmailBody()"
          (closeDetail)="onCloseEmail()"
          (downloadAttachment)="onDownloadAttachment($event)" />
      }
    </div>
  </main>
</div>
